# install tpm: git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
# Press prefix + I (capital i, as in Install) to fetch the plugin
# Press prefix + alt + u (lowercase u as in uninstall) to remove the plugin.
# prefix + U updates plugins

# !!!!!!!!!!!!!!!!!!!!!!!!!
# 禁止在tmux下使用Neovim
# !!!!!!!!!!!!!!!!!!!!!!!!!

# 重启tmux: tmux kill-server
# 加载环境: tmux source-file ~/.tmux.conf
# 查看tmux版本: tmux -V

# Session
## 查看Session列表: tmux ls
## 新建Session: tmux new-session -A -s <session_name>
## 进入Session: tmux attach-session -t <session_name>
## 切换Session: tmux switch-client -t <session_name>
## 分离Session(后台运行): tmux detach 或者 <prefix>d
## 分离Session(会话终止): Ctrl+d
## 删除Session: tmux kill-session -t <session_name>

#############################
####  TPM插件管理器  ########
#############################
# 安装插件: <prefix>I
set -g @plugin 'tmux-plugins/tpm'

set -g @plugin 'tmux-plugins/tmux-sensible'

## --------catppuccin/tmux-------------------
# https://github.com/catppuccin/tmux
# need tmux3.4+(https://github.com/catppuccin/tmux/issues/183)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'macchiato' # or frappe, macchiato, mocha
set -g @catppuccin_date_time_text "%Y-%m-%d %H:%M"
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
# set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_default_text "#{window_name}" # show window name
set -g @catppuccin_window_current_fill "number"
# set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_window_current_text "#{window_name}" # show window name
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{pane_current_path}"
## ----------------------------------------

# 文本复制
set -g @plugin 'tmux-plugins/tmux-yank'

# pane 控制
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Session管理
# https://github.com/tmux-plugins/tmux-sessionist
set -g @plugin 'tmux-plugins/tmux-sessionist'

## --------tmux-resurrect-------------------
# 克隆当前整个会话session
set -g @plugin 'tmux-plugins/tmux-resurrect'
# 保存当前会话状态
bind C-s source-file ~/.tmux.conf \; run-shell ~/.tmux/plugins/tmux-resurrect/scripts/save.sh
# 恢复上次会话状态
bind C-r source-file ~/.tmux.conf \; run-shell ~/.tmux/plugins/tmux-resurrect/scripts/restore.sh
## ----------------------------------------

#############################
#### General settings #######
#############################
# tmux配置文件配色
set -g default-terminal "screen-256color"

# Start index of window/pane with 1, because we're humans, not computers
set -g base-index 1
set -g pane-base-index 1
set -g renumber-windows on

# Enable mouse support
set -g mouse on

set -g @copy_use_osc52_fallback on

bind C-p choose-buffer

#############################
######### leader键 ##########
#############################
# 解绑默认的C-b
unbind C-b
# 重新绑定C-a为leader键
set -g prefix C-a
bind C-a send-prefix

#############################
######### 导航键 ##########
#############################
# 允许使用鼠标选择窗格、调整窗格大小、切换窗口等
# 使用vi模式的键绑定进行导航
setw -g mode-keys vi
# `bind -n` 用于绑定一个快捷键，但不需要按下前缀键
# `bind -r` 用于绑定一个快捷键，设置为可重复(repeatable)
# 切换到左侧pane
bind -n C-h select-pane -L
# 切换到下侧pane
bind -n C-j select-pane -D
# 切换到上侧pane
bind -n C-k select-pane -U
# 切换到右侧pane
bind -n C-l select-pane -R
# 移动pane
bind -r C-o swap-pane -D
# 循环切换pane
bind -r [ select-pane -t :.-
bind -r ] select-pane -t :.+
# 单独放大pane
bind + resize-pane -Z

# 关闭pane
bind x kill-pane
#关闭window
bind X kill-window
bind C-x confirm-before -p "kill other windows? (y/n)" "kill-window -a"
# 关闭当前会话
bind Q confirm-before -p "kill-session #S? (y/n)" kill-session
# 新建window
bind c new-window
# 下一个window
# bind n next-window
bind -n C-n next-window
# 上一个window
bind p previous-window
# 切换上一个window
bind -r Tab last-window
# 切换window(prefix+n)
bind-key 1 select-window -t 1
bind-key 2 select-window -t 2
bind-key 3 select-window -t 3
bind-key 4 select-window -t 4
bind-key 5 select-window -t 5
bind-key 6 select-window -t 6
bind-key 7 select-window -t 7
bind-key 8 select-window -t 8
bind-key 9 select-window -t 9

# Detach from session
bind d detach
bind D if -F '#{session_many_attached}' \
    'confirm-before -p "Detach other clients? (y/n)" "detach -a"' \
    'display "Session has only 1 client attached"'

#############################
#####  窗口和窗格分割  ######
#############################
bind | split-window -h -c "#{pane_current_path}"
bind _ split-window -v -c "#{pane_current_path}"

# Rename session and window
bind r command-prompt -I "#{window_name}" "rename-window '%%'"
bind R command-prompt -I "#{session_name}" "rename-session '%%'"

#############################
######  状态栏样式   ########
#############################
# set -g status-bg black
# set -g status-fg white
# # # 状态栏左侧内容
# set -g status-left '#[fg=green]#S #[fg=yellow]%Y-%m-%d %H:%M:%S'
# # 状态栏右侧内容
# set -g status-right '#[fg=cyan]#(whoami)@#(hostname -s) #[fg=green]#H:%M:%S'

# 初始化TM插件
run '~/.tmux/plugins/tpm/tpm'
